# Create user if does not exist
- name: Check if user exists
  command: id -u {{ user }}
  register: user_exists
  ignore_errors: yes

- name: Create user
  user:
    name: '{{ user }}'
    shell: /bin/bash
  become: yes
  become_method: sudo
  when: user_exists.rc != 0

# Update cache and install Python for Ansible
#   Debian OS family
- name: Update cache (Debian)
  apt:
    update_cache: true
  when: ansible_os_family == "Debian"

- name: Install Python for Ansible on Debian
  raw: test -e /usr/bin/python || (apt -y update && apt install -y python-minimal)
  when: ansible_os_family == "Debian"

#   Archlinux OS
- name: Update cache (Arch)
  pacman:
    update_cache: yes
  when: ansible_os_family == "Archlinux"

- name: Install Python for Ansible on Arch
  raw: test -e /usr/bin/python || (pacman -Sy --noconfirm python)
  when: ansible_os_family == "Archlinux"
